<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1>Testing</h1>

    <script>
      const state = {
        stock : {
          coffe : 1000,
          water : 1,
        },
        sibuk : false
      }

      const cekMesin= () => {
        return new Promise((resolve, reject)=>{
          setTimeout(()=>{
            if(!state.sibuk){
              resolve("Mesin Bisa digunakan");
            }else{
              reject("Mesin sedang sibun");
            }
          },1000);
        })
      }

      const cekStok = () => {
        return new Promise((resolve, reject)=>{
          state.sibuk = true;
          setTimeout(()=>{
            if (state.stock.coffe >= 100 && state.stock.water >= 100){
              resolve("Stock Mencukupi");
            }else{
              reject("Stock tidak cukup");
            }
          },1500);
        })
      }

      const buatKopi = () => {
        console.log("Membuat Kopi anda");
        return new Promise((resolve, reject)=>{
          setTimeout(()=>{
            resolve("Kopi sudah jadi");
          },2000);
        })
      }

      function buatKopiEnak (){
        cekMesin()
        .then((value)=>{
          console.log(value);
          return cekStok();
        })
        .then((value)=>{
          console.log(value);
          return buatKopi();
        })
        .then((value)=>{
          console.log(value);
          state.sibuk=false;
        })
        .catch(rejectedReason => {
          console.log(rejectedReason);
          state.sibuk=false;
        });
      }
      buatKopiEnak();
    </script>
  </body>
</html>
